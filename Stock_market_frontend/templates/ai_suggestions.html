{% extends 'base.html' %}
{% load static %}

{% block title %}AI Advisor - TradeHelper.AI{% endblock %}

{% block content %}
<div class="container" style="max-width: 1400px; padding: 2rem 1rem;">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold mb-2" style="color: var(--text-primary);">
                <i class="fas fa-robot" style="color: var(--primary);"></i> AI-Powered Stock Suggestions
            </h1>
            <p class="text-muted">Ultra-conservative AI recommendations powered by Gemini</p>
        </div>
    </div>

    <!-- Investment Input Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" action="{% url 'ai_suggestions' %}" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold">Investment Amount</label>
                    <div class="input-group">
                        <span class="input-group-text">‚Çπ</span>
                        <input type="number" class="form-control" name="amount" value="{{ investment_amount|default:10000 }}" required>
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-bold">Stock Category</label>
                    <select class="form-select" name="type">
                        <option value="large_cap" {% if stock_type == 'large_cap' %}selected{% endif %}>üè¢ Large Cap - Blue Chips</option>
                        <option value="mid_cap" {% if stock_type == 'mid_cap' %}selected{% endif %}>üìä Mid Cap - Growth Stocks</option>
                        <option value="small_cap" {% if stock_type == 'small_cap' %}selected{% endif %}>üöÄ Small Cap - High Growth</option>
                        <option value="mix" {% if stock_type == 'mix' %}selected{% endif %}>üéØ Balanced Mix</option>
                        <option value="it_sector" {% if stock_type == 'it_sector' %}selected{% endif %}>üíª IT Sector</option>
                        <option value="banking" {% if stock_type == 'banking' %}selected{% endif %}>üè¶ Banking Sector</option>
                        <option value="pharma" {% if stock_type == 'pharma' %}selected{% endif %}>üíä Pharma Sector</option>
                    </select>
                </div>

                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100" style="padding: 0.75rem;">
                        <i class="fas fa-magic"></i> Get AI Suggestions
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Market Status Alert (ADD THIS SECTION) -->
    {% if market_status %}
    <div class="alert alert-{% if market_status.is_open %}success{% else %}warning{% endif %} mb-4" style="border-radius: 12px;">
        <h5 class="mb-2">
            {% if market_status.is_open %}
                üü¢ Market Status: OPEN
            {% else %}
                üî¥ Market Status: CLOSED
            {% endif %}
        </h5>
        <p class="mb-1"><strong>{{ market_status.message }}</strong></p>
        <small><i class="far fa-clock"></i> Current Time: {{ market_status.current_time }} IST ({{ market_status.current_day }})</small>
    </div>
    {% endif %}

    <!-- Market Closed Message (ADD THIS SECTION) -->
    {% if market_closed %}
    <div class="card text-center py-5" style="background: linear-gradient(135deg, rgba(255, 168, 52, 0.05), rgba(255, 75, 75, 0.05));">
        <div class="card-body">
            <i class="fas fa-calendar-times fa-4x mb-4" style="color: #FFA834;"></i>
            <h3 class="mb-3">Market is Currently Closed</h3>
            <p class="text-muted mb-4">AI-powered suggestions are only available during live market hours.</p>
            <div class="alert alert-info d-inline-block">
                <strong>NSE Trading Hours:</strong> Monday - Friday, 9:15 AM - 3:30 PM IST
            </div>
            <p class="mt-4 text-muted">
                <i class="fas fa-info-circle"></i> Please try again during market hours for real-time stock analysis.
            </p>
        </div>
    </div>
    {% endif %}

    <!-- AI Suggestions -->
    {% if suggestions %}
    <div class="row">
        {% for suggestion in suggestions %}
        <div class="col-lg-6 mb-4">
            <div class="card h-100" style="transition: all 0.3s ease;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ suggestion.symbol }}</h5>
                    <span class="badge" style="
                        background: {% if suggestion.action == 'BUY' %}rgba(0, 208, 156, 0.1){% elif suggestion.action == 'SELL' %}rgba(255, 75, 75, 0.1){% else %}rgba(255, 168, 52, 0.1){% endif %};
                        color: {% if suggestion.action == 'BUY' %}#00D09C{% elif suggestion.action == 'SELL' %}#FF4B4B{% else %}#FFA834{% endif %};
                        padding: 0.5rem 1rem;
                        font-size: 0.9rem;
                        font-weight: 700;
                    ">
                        {{ suggestion.action }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <small class="text-muted">Current Price</small>
                            <h4 class="mb-0">‚Çπ{{ suggestion.current_price|floatformat:2 }}</h4>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Target Price</small>
                            <h4 class="mb-0 positive">‚Çπ{{ suggestion.target_price|floatformat:2 }}</h4>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-6">
                            <small class="text-muted">Stop Loss</small>
                            <h5 class="negative">‚Çπ{{ suggestion.stop_loss|floatformat:2 }}</h5>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Confidence</small>
                            <div class="progress" style="height: 24px;">
                                <div class="progress-bar bg-success" style="width: {{ suggestion.confidence }}%">
                                    {{ suggestion.confidence }}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted">Expected Return</small>
                        <h3 class="positive">+{{ suggestion.expected_return|floatformat:2 }}%</h3>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted d-block mb-2">AI Analysis:</small>
                        <p class="text-muted small">{{ suggestion.reasoning }}</p>
                    </div>

                    <div class="mt-3">
                        <small class="text-muted d-block mb-2">Key Signals:</small>
                        {% for signal in suggestion.key_signals %}
                        <span class="badge bg-secondary me-1 mb-1" style="font-weight: 400;">{{ signal }}</span>
                        {% endfor %}
                    </div>

                    <div class="mt-3 pt-3" style="border-top: 1px solid #e0e0e0;">
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> Source: <strong>{{ suggestion.source }}</strong>
                            | Risk Level: <strong>{{ suggestion.risk_level }}</strong>
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% elif not market_closed and not suggestions %}
    <div class="card text-center py-5" style="background: linear-gradient(135deg, rgba(0, 208, 156, 0.05), rgba(83, 103, 255, 0.05));">
        <div class="card-body">
            <i class="fas fa-robot fa-4x mb-3" style="color: var(--primary);"></i>
            <h4>No AI Suggestions Available</h4>
            <p class="text-muted">Enter your investment amount and select stock category to get personalized AI-powered recommendations</p>
            <button class="btn btn-primary btn-lg mt-3" onclick="document.querySelector('input[name=amount]').focus()">
                <i class="fas fa-magic"></i> Get Started
            </button>
        </div>
    </div>
    {% endif %}
</div>

<style>
.positive { color: #00D09C; }
.negative { color: #FF4B4B; }
</style>
{% endblock %}
